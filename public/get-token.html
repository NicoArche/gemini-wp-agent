<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîë Obtener Token - Gemini WP-CLI</title>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #2d2d2d;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #404040;
        }
        
        .title {
            color: #00ff88;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .step {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
            border-left: 4px solid #00ff88;
        }
        
        .step h3 {
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .code {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            color: #00ff88;
            margin: 10px 0;
            word-break: break-all;
        }
        
        .warning {
            background: rgba(255, 189, 46, 0.1);
            border: 1px solid #ffbd2e;
            color: #ffbd2e;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .success {
            background: rgba(39, 202, 63, 0.1);
            border: 1px solid #27ca3f;
            color: #27ca3f;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .button {
            background: #00ff88;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            margin: 10px 5px;
            transition: all 0.2s ease;
        }
        
        .button:hover {
            background: #00cc6a;
            transform: translateY(-1px);
        }
        
        .input-field {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #404040;
            color: #e0e0e0;
            padding: 12px;
            border-radius: 6px;
            font-family: inherit;
            margin: 10px 0;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #00ff88;
        }
        
        #tokenResult {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üîë Obtener Token de Seguridad</h1>
        
        <div class="step">
            <h3>üìã Instrucciones</h3>
            <p>Para obtener tu token de seguridad, tienes varias opciones:</p>
        </div>
        
        <div class="step">
            <h3>üéØ Opci√≥n 1: Desde WordPress Admin (Recomendado)</h3>
            <ol>
                <li>Ve a tu WordPress Admin</li>
                <li>Navega a <strong>Configuraci√≥n ‚Üí Gemini WP-CLI</strong></li>
                <li>Copia el token desde la p√°gina de administraci√≥n</li>
                <li>El token se genera autom√°ticamente y es √∫nico para tu sitio</li>
            </ol>
        </div>
        
        <div class="step">
            <h3>üåê Opci√≥n 2: Desde API REST (Para Administradores)</h3>
            <p>Si tienes acceso de administrador, puedes obtener el token via API:</p>
            
            <label for="wpUrl">URL de tu WordPress:</label>
            <input type="url" 
                   id="wpUrl" 
                   class="input-field" 
                   placeholder="https://tu-sitio.com"
                   value="https://nicoarche.com">
            
            <button onclick="getTokenFromAPI()" class="button">üîç Obtener Token</button>
            
            <div class="warning">
                ‚ö†Ô∏è <strong>Nota:</strong> Debes estar logueado como administrador en WordPress para que esto funcione.
            </div>
        </div>
        
        <div id="tokenResult" class="step">
            <h3>‚úÖ Token Obtenido</h3>
            <div id="tokenDisplay"></div>
        </div>
        
        <div class="step">
            <h3>üîí Seguridad del Token</h3>
            <ul>
                <li>‚úÖ <strong>√önico por sitio:</strong> Cada WordPress tiene su propio token</li>
                <li>‚úÖ <strong>Generaci√≥n segura:</strong> Usa SHA-256 con m√∫ltiples fuentes de entrop√≠a</li>
                <li>‚úÖ <strong>Regenerable:</strong> Puedes crear uno nuevo cuando quieras</li>
                <li>‚úÖ <strong>No expira:</strong> El token es v√°lido hasta que lo regeneres</li>
                <li>‚ö†Ô∏è <strong>Mant√©n seguro:</strong> No compartas el token p√∫blicamente</li>
            </ul>
        </div>
        
        <div class="step">
            <h3>üöÄ Usar el Token</h3>
            <ol>
                <li>Copia el token completo</li>
                <li>Abre la aplicaci√≥n Gemini WP-CLI Terminal</li>
                <li>Haz clic en ‚öôÔ∏è para abrir configuraci√≥n</li>
                <li>Pega el token en el campo "Token de Seguridad"</li>
                <li>Completa la URL de tu WordPress</li>
                <li>¬°Listo para usar comandos WP-CLI!</li>
            </ol>
        </div>
    </div>

    <script>
        async function getTokenFromAPI() {
            const wpUrl = document.getElementById('wpUrl').value.trim();
            
            if (!wpUrl) {
                alert('Por favor, ingresa la URL de tu WordPress');
                return;
            }
            
            const cleanUrl = wpUrl.replace(/\/$/, '');
            
            try {
                const response = await fetch(`${cleanUrl}/wp-json/gemini/v1/token`, {
                    method: 'GET',
                    credentials: 'include' // Incluir cookies de sesi√≥n
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayToken(data);
                } else if (response.status === 401 || response.status === 403) {
                    alert('‚ùå No tienes permisos de administrador o no est√°s logueado en WordPress.\n\nPor favor:\n1. Inicia sesi√≥n como administrador en WordPress\n2. Intenta de nuevo\n\nO usa la Opci√≥n 1 desde el admin de WordPress.');
                } else {
                    const errorData = await response.json();
                    alert(`‚ùå Error: ${errorData.message || 'No se pudo obtener el token'}`);
                }
            } catch (error) {
                alert(`‚ùå Error de conexi√≥n: ${error.message}\n\nVerifica que:\n1. La URL sea correcta\n2. El plugin est√© activado\n3. Tengas conexi√≥n a internet`);
            }
        }
        
        function displayToken(data) {
            const resultDiv = document.getElementById('tokenResult');
            const displayDiv = document.getElementById('tokenDisplay');
            
            displayDiv.innerHTML = `
                <div class="success">
                    <strong>üéâ Token obtenido exitosamente!</strong>
                </div>
                
                <p><strong>Token completo:</strong></p>
                <div class="code" id="fullToken">${data.token}</div>
                <button onclick="copyToken()" class="button">üìã Copiar Token</button>
                
                <p><strong>Vista previa:</strong> <code>${data.token_preview}</code></p>
                <p><strong>Generado:</strong> ${data.generated_at}</p>
                
                <div class="warning">
                    <strong>üìã Instrucciones:</strong><br>
                    ${data.instructions.copy_token}<br><br>
                    <strong>üîí Seguridad:</strong><br>
                    ${data.instructions.security_note}
                </div>
            `;
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function copyToken() {
            const tokenElement = document.getElementById('fullToken');
            const range = document.createRange();
            range.selectNode(tokenElement);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Copiado!';
            button.style.backgroundColor = '#27ca3f';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.backgroundColor = '#00ff88';
            }, 2000);
        }
    </script>
</body>
</html>